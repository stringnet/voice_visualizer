<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualizer 360 - Org√°nico</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: radial-gradient(circle at center, #d8c7ff 0%, #5c00b5 100%);
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="visualizer"></canvas>
<audio id="audio" controls autoplay style="display: none;"></audio>

<script>
const canvas = document.getElementById('visualizer');
const ctx = canvas.getContext('2d');
const audio = document.getElementById('audio');

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioContext.createAnalyser();
analyser.fftSize = 512;
const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);

const source = audioContext.createMediaElementSource(audio);
source.connect(analyser);
analyser.connect(audioContext.destination);

audio.src = "https://streamer.scanmee.io/stream";
audio.crossOrigin = "anonymous";

audio.onplay = () => {
  if (audioContext.state === 'suspended') {
    audioContext.resume();
  }
};

function draw() {
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);

  const radius = Math.min(canvas.width, canvas.height) / 4;
  const points = 64;
  const slice = Math.PI * 2 / points;

  ctx.beginPath();

  for (let i = 0; i <= points; i++) {
    const value = dataArray[i % bufferLength] / 255;
    const r = radius + value * 100;
    const angle = slice * i;

    const x = r * Math.cos(angle);
    const y = r * Math.sin(angle);

    if (i === 0) {
      ctx.moveTo(x, y);
    } else {
      ctx.lineTo(x, y);
    }
  }

  ctx.closePath();
  ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
  ctx.lineWidth = 3;
  ctx.stroke();

  ctx.restore();
}

draw();
</script>
</body>
</html>
